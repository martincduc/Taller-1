<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Libre & Rico — Catálogo</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --muted:#6b7280;
      --primary:#2563eb; --primary-dark:#1e40af;
      --ok:#059669; --warn:#a16207; --err:#b91c1c;
      --pill:#111827; --shadow:0 8px 22px rgba(0,0,0,.08);
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg)}
    .container{max-width:980px;margin:36px auto;padding:0 16px}
    h1{margin:0 0 4px;font-size:22px}
    .sub{margin:0 0 16px;color:var(--muted);font-size:13px}
    .card{background:var(--card);border-radius:14px;box-shadow:var(--shadow);padding:16px}

    
    .filters{display:grid;grid-template-columns:1fr 1fr 2fr auto;gap:10px;align-items:end}
    .field label{display:block;margin-bottom:6px;font-size:13px;color:#111827}
    .field select,.field input{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;font-size:14px}
    .btn{padding:10px 14px;border:0;border-radius:10px;background:var(--primary);color:#fff;font-weight:600;cursor:pointer}
    .btn:hover{background:var(--primary-dark)}
    .btn-outline{background:#fff;color:#111827;border:1px solid #e5e7eb}
    .meta{margin:12px 0 0;font-size:12px;color:var(--muted)}

    
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
    .prod{border:1px solid #eef0f4;border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px}
    .prod h3{margin:0;font-size:15px}
    .price{display:inline-block;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:999px;padding:4px 8px;font-size:12px;color:var(--pill)}
    .stock{font-size:12px}
    .stock.ok{color:var(--ok)}
    .stock.out{color:var(--err);font-weight:600}
    .prod .actions{margin-top:4px}
    .prod button{width:100%;padding:10px;border-radius:10px;border:0;background:#10b981;color:#fff;cursor:pointer}
    .prod button:disabled{background:#e5e7eb;color:#9ca3af;cursor:not-allowed}

   
    .state{display:none;margin-top:12px;padding:12px;border-radius:12px;font-size:14px}
    .state.info{background:#eef6ff;color:#1e3a8a}
    .state.warn{background:#fff7ed;color:#7c2d12}
    .state.error{background:#fee2e2;color:#7f1d1d}

    
    .pager{display:flex;gap:6px;justify-content:center;align-items:center;margin-top:10px}
    .pager button{padding:8px 10px;border:1px solid #e5e7eb;background:#fff;border-radius:10px;cursor:pointer}
    .pager button[disabled]{opacity:.5;cursor:not-allowed}
    .pager .page{padding:6px 10px;border-radius:10px;border:1px solid #e5e7eb;background:#fff}
    .pill{font-size:12px;color:var(--muted)}

    @media (max-width:820px){
      .grid{grid-template-columns:1fr 1fr}
      .filters{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Catálogo de productos</h1>
   
    
    <div class="card">
      <form id="filters" class="filters">
        <div class="field">
          <label for="categoria">Categoría</label>
          <select id="categoria">
            <option value="all">Todas</option>
            <option value="Pan">Pan</option>
            <option value="Galletas">Galletas</option>
            <option value="Snacks">Snacks</option>
          </select>
        </div>
        <div class="field">
          <label for="disp">Disponibilidad</label>
          <select id="disp">
            <option value="all">Todas</option>
            <option value="stock">En stock</option>
          </select>
        </div>
        <div class="field">
          <label for="q">Buscar por nombre</label>
          <input id="q" type="search" placeholder="brownie, pan, muffin…"/>
        </div>
        <button class="btn" type="submit">Aplicar filtros</button>
      </form>
      <div class="meta">
        <span id="counter" class="pill"></span>
      </div>

      
      <div id="state-empty" class="state warn">0 resultados. <button id="clear" class="btn btn-outline" style="margin-left:8px">Limpiar filtros</button></div>
      <div id="state-error" class="state error">No se pudo cargar el catálogo. <button id="retry" class="btn btn-outline" style="margin-left:8px">Reintentar</button></div>

      <!-- Grid de productos -->
      <div id="grid" class="grid"></div>

     
      <div class="pager">
        <button id="prev">◀</button>
        <span id="pages" class="page">Página 1</span>
        <button id="next">▶</button>
      </div>
    </div>
  </div>

  <script>
   
    const PRODUCTS = [
      {id:1,  name:"Pan molde sin gluten 450g", price:3990, stock:8,  category:"Pan",      featured:true},
      {id:2,  name:"Galletas avena",             price:2490, stock:0,  category:"Galletas", featured:false},
      {id:3,  name:"Pack desayuno (combo)",      price:6990, stock:3,  category:"Snacks",   featured:true},
      {id:4,  name:"Baguette sin gluten",        price:3290, stock:5,  category:"Pan",      featured:false},
      {id:5,  name:"Ciabatta sin gluten",        price:3490, stock:2,  category:"Pan",      featured:false},
      {id:6,  name:"Crackers romero",            price:1990, stock:12, category:"Galletas", featured:false},
      {id:7,  name:"Muffin chocolate",           price:1790, stock:6,  category:"Snacks",   featured:false},
      {id:8,  name:"Pan de campo",               price:4190, stock:4,  category:"Pan",      featured:false},
      {id:9,  name:"Cookies chips",              price:2890, stock:0,  category:"Galletas", featured:false},
      {id:10, name:"Brownie clásico",            price:2290, stock:7,  category:"Snacks",   featured:false},
      {id:11, name:"Pan pita",                   price:2590, stock:9,  category:"Pan",      featured:false},
      {id:12, name:"Galletas cacao",             price:2690, stock:1,  category:"Galletas", featured:false},
      {id:13, name:"Snack mix frutos",           price:2390, stock:8,  category:"Snacks",   featured:false},
      {id:14, name:"Pan molde integral",         price:4090, stock:0,  category:"Pan",      featured:false},
      {id:15, name:"Crackers sésamo",            price:2090, stock:15, category:"Galletas", featured:false},
    ];

   
    const PAGE_SIZE = 12;

    
    const els = {
      grid: document.getElementById("grid"),
      counter: document.getElementById("counter"),
      empty: document.getElementById("state-empty"),
      error: document.getElementById("state-error"),
      clear: document.getElementById("clear"),
      retry: document.getElementById("retry"),
      prev: document.getElementById("prev"),
      next: document.getElementById("next"),
      pages: document.getElementById("pages"),
      form: document.getElementById("filters"),
      cat: document.getElementById("categoria"),
      disp: document.getElementById("disp"),
      q: document.getElementById("q"),
    };

    let page = 1;
    let lastFiltered = [];

    
    function orderProducts(arr){
      return [...arr].sort((a,b)=>{
        if (a.featured !== b.featured) return a.featured ? -1 : 1;
        if (a.price !== b.price) return a.price - b.price;
        return a.name.localeCompare(b.name);
      });
    }

    
    function filterProducts(){
      const cat = els.cat.value;
      const disp = els.disp.value;
      const term = els.q.value.trim().toLowerCase();

      let res = PRODUCTS.filter(p => p.price > 0); // sólo con precio vigente

      if (cat !== "all") res = res.filter(p => p.category === cat);
      if (disp === "stock") res = res.filter(p => p.stock > 0);
      if (term) res = res.filter(p => p.name.toLowerCase().includes(term));

      return orderProducts(res);
    }

   
    function productCard(p){
      const disabled = p.stock <= 0;
      const stockText = disabled ? '<span class="stock out">Agotado</span>'
                                 : `<span class="stock ok">Stock: ${p.stock}</span>`;
      const btn = `<button ${disabled ? "disabled": ""}>Agregar</button>`;

      return `
        <article class="prod">
          <h3>${p.name}</h3>
          <span class="price">$${p.price.toLocaleString("es-CL")}</span>
          ${stockText}
          <div class="actions">${btn}</div>
        </article>`;
    }

    function showState(el){ el.style.display = "block"; }
    function hideState(el){ el.style.display = "none"; }

    
    function render(){
      hideState(els.error);
      const total = lastFiltered.length;
      const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
      page = Math.min(page, totalPages);

      const start = (page-1) * PAGE_SIZE;
      const items = lastFiltered.slice(start, start + PAGE_SIZE);

      els.grid.innerHTML = items.map(productCard).join("");
      els.counter.textContent = `${total} producto(s) encontrados`;
      els.pages.textContent = `Página ${page} de ${totalPages}`;
      els.prev.disabled = page === 1;
      els.next.disabled = page === totalPages;

      if (total === 0){
        showState(els.empty);
      } else {
        hideState(els.empty);
      }
    }

   
    els.form.addEventListener("submit", (e)=>{
      e.preventDefault();
      page = 1;
      lastFiltered = filterProducts();
      render();
    });

    els.clear.addEventListener("click", ()=>{
      els.cat.value = "all";
      els.disp.value = "all";
      els.q.value = "";
      page = 1;
      lastFiltered = filterProducts();
      render();
    });

    els.prev.addEventListener("click", ()=>{ if(page>1){ page--; render(); } });
    els.next.addEventListener("click", ()=>{ page++; render(); });

    
    let failOnce = false;
    function loadCatalog(){
      if(!failOnce){
        failOnce = true;
        showState(els.error);
        els.grid.innerHTML = "";
        els.counter.textContent = "";
        els.pages.textContent = "—";
        els.prev.disabled = els.next.disabled = true;
        return;
      }
      hideState(els.error);
      lastFiltered = filterProducts();
      render();
    }
    els.retry.addEventListener("click", loadCatalog);

  
    loadCatalog(); 
  </script>
</body>
</html>
